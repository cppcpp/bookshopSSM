<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <link href="css/bootstrap.min.css" rel="stylesheet" type="text/css">
  <link href="css/font-awesome.min.css" rel="stylesheet" type="text/css">
  <link href="css/style.css" rel="stylesheet" type="text/css">
  <title>书城</title>
</head>
<body>
<header>
  <div class="row col-lg-12 col-md-12 col-sm-12 col-xs-12">
    <ul class="col-md-2 col-sm-4 col-xs-6 sol-xs-offset-6 sol-sm-offset-8 col-md-offset-10 clearfix">
      <li><a href="login.html">登录</a></li>
      <li><a href="register.html">注册</a></li>
    </ul>
  </div>
</header>

<nav>
  <div class="container">
    <div class="row col-md-12">
      <nav class="navbar navbar-default">
        <div class="container-fluid">
          <!-- Brand and toggle get grouped for better mobile display -->
          <div class="navbar-header col-md-1">
            <a class="navbar-brand" href="index.html">
              <img src="img/logo.png" alt="Logo">
            </a>
            <button type="button" class="navbar-toggle collapsed button-collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>

          </div>
          <!-- id 关联上面的折叠 -->
          <div class="collapse navbar-collapse nav-collapsed-area" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right clearfix">
              <li><a href="index.html">首页</a></li>
              <li><a href="category.html">书城</a></li>
              <li><a href="special.html">特价</a></li>
              <li><a href="mineInfo.html">我的</a></li>
              <li><a href="about.html">关于我们</a></li>
            </ul>
          </div><!-- /.navbar-collapse -->
        </div><!-- /.container-fluid -->
      </nav>
    </div>
  </div>
  <div class="nav-cart-area">
    <a href="cart.html"><span class="nav-cart"><img src="img/icon-cart.png"></span></a>
    <span class="cart-num">3</span>
  </div>
</nav>

<!--back to top-->
<p id="back-to-top">
  <a href="#top"><img src="img/top_arrow1.png"/></a>
</p>

<section id="booklist">
  <div class="container">
    <div class="row">
      <div class="col-md-3">
        <div class="categrory">
          <div class="booklist-categrory-top">
            <div><i class="fa fa-list"></i>&nbsp;&nbsp;图&nbsp;书&nbsp;分&nbsp;类</div>
          </div>
          <div class="booklist-categrory-content">
            <ul class="list">
              <a href="category.html?category=a" ><li><i class="glyphicon glyphicon-eye-open"></i>马列主义、毛泽东思想(A)</li></a>
              <a href="category.html?category=b" ><li><i class="glyphicon glyphicon-bookmark"></i>哲学(B)</li></a>
              <a href="category.html?category=c" ><li><i class="glyphicon glyphicon-adjust"></i>社会科学(C)</li></a>
              <a href="category.html?category=d"><li><i class="glyphicon glyphicon-book"></i>政治、法律(D)</li></a>
              <a href="category.html?category=e"><li><i class="glyphicon glyphicon-fire"></i>军事(E)</li></a>
              <a href="category.html?category=f"><li><i class="glyphicon glyphicon-usd"></i>经济(F)</li></a>
              <a href="category.html?category=g"><li><i class="glyphicon glyphicon-education"></i>文化、科学、教育、体育(G)</li></a>
              <a href="category.html?category=h"><li><i class="glyphicon glyphicon-text-width"></i>语言、文字(H)</li></a>
              <a href="category.html?category=i"><li><i class="glyphicon glyphicon-user"></i>文学(I)</li></a>
              <a href="category.html?category=j"><li><i class="glyphicon glyphicon-certificate"></i>艺术(J)</li></a>
              <a href="category.html?category=k"><li><i class="glyphicon glyphicon-globe"></i>历史、地理(K)</li></a>
              <a href="category.html?category=n"><li><i class="glyphicon glyphicon-indent-left"></i>自然科学总论(N)</li></a>
              <a href="category.html?category=o"><li><i class="glyphicon glyphicon-wrench"></i>数理科学和化学(O)</li></a>
              <a href="category.html?category=p"><li><i class="glyphicon glyphicon-hand-right"></i>天文学、地球科学(P)</li></a>
              <a href="category.html?category=q"><li><i class="glyphicon glyphicon-tree-conifer"></i>生物科学(Q)</li></a>
              <a href="category.html?category=r"><li><i class="glyphicon glyphicon-briefcase"></i>医药、卫生(R)</li></a>
              <a href="category.html?category=s"><li><i class="glyphicon glyphicon-leaf"></i>农业科学(S)</li></a>
              <a href="category.html?category=t"><li><i class="glyphicon glyphicon-map-marker"></i>工业科学(T)</li></a>
              <a href="category.html?category=u"><li><i class="glyphicon glyphicon-road"></i>交通运输(U)</li></a>
              <a href="category.html?category=v"><li><i class="glyphicon glyphicon-plane"></i>航空、航天(V)</li></a>
              <a href="category.html?category=x"><li><i class="glyphicon glyphicon-tree-deciduous"></i>环境科学(X)</li></a>
              <a href="category.html?category=z"><li><i class="glyphicon glyphicon-hand-right"></i>综合性图书(Z)</li></a>
         </ul>
          </div>
        </div>
      </div>

      <div class="col-md-9">
        <div class="row">
            <div class="sort">
              <ul>
                <!-- 后期加上默认显示所有书籍   --》 booksListServlet -->
                <li><a id="defaut">默认</a><span class="split">|</span></li>
                <li><a id="b_sale_num"><span id="b_sale_text">销量</span>
                  <i id="b_sale_num_asc" class="fa fa-arrow-up"></i>
                  <i id="b_sale_num_desc" class="fa fa-arrow-down"></i>
                </a>
                  <span class="split">|</span>
                </li>
                <li><a id="b_discount"><span id="b_sale_text">折扣</span>
                   <i id="b_discount_asc" class="fa fa-arrow-up"></i>
                  <i id="b_discount_desc" class="fa fa-arrow-down"></i>
                </a>
                  <span class="split">|</span>
                </li>
                <li><a id="b_add_time"><span id="b_sale_text">最新</span>
                  <i id="b_add_time_asc" class="fa fa-arrow-up"></i>
                  <i id="b_add_time_desc" class="fa fa-arrow-down"></i>
                </a>
                  <span class="split">|</span>
                </li>
                
                <li><a id="b_price"><span id="b_price_text">价格</span>
                  <i id="b_price_asc" class="fa fa-arrow-up"></i>
                  <i id="b_price_desc" class="fa fa-arrow-down"></i>
                </a>
                  <span class="split">|</span>
                </li>
                <li><a><span>价格区间：</span>
                <input id="input_left" type="text" class="input1">-
                <input id="input_right" type="text" class="input1">
               </a> </li>
				<li>
				 <input id="input_submit" type="button" value="确定">
				 <input id="input_reset" type="reset" value="取消" >
				</li>            
              </ul>
            </div>
        </div>
        <div class="row new_products">
        
        </div>

        <div class="row papigation">
          <span class="papigation-button" onclick="toPage('index')">首页</span>
          <span class="papigation-button" onclick="toPage('prev')">上一页</span>
          <span class="papigation-button" onclick="toPage('next')">下一页</span>
          <span class="papigation-button" onclick="toPage('end')">尾页</span>
          <span class="papigationPage">第1页／共8页</span>
          <span>设置每页&nbsp;<input type="text" id="pageSize" style="width: 30px;">&nbsp;条</span>
        </div>

      </div>
    </div>
  </div>
</section>



<!-- footer Start -->
<footer>
  <div class="container">
    <div class="row">
      <div class="col-md-12">
        <div class="footer-manu">
          <ul>
            <li><a href="#">首页</a></li>
            <li><a href="#">书城</a></li>
            <li><a href="#">特价</a></li>
            <li><a href="#">我的</a></li>
            <li><a href="#">联系我们</a></li>
          </ul>
        </div>
        <p>Copyright &copy; Design & SHY</p>
      </div>
    </div>
  </div>
</footer>

</body>
</html>
<script src="js/jquery-2.2.4.min.js"></script>
<script src="js/bootstrap.min.js"></script>
<script src="js/index.js"></script>
<script type="text/javascript">
	var totalPage,currpage,limit,category
	var discount,saleNum,newset,price,lowsetPrice,highestPrice
	$(function(){
		function getQueryString(name) {
			var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)","i")
			var r = window.location.search.substr(1).match(reg)
			 if (r != null) return unescape(r[2]); 
	        return null; 
		}
		category = getQueryString('category') || 'a'
		getLists()

	})
	
	function getLists(page,limit){
		if(!page) {
			page = 1
		}
		if(!limit) {
			limit = 10
		}
		$.ajax({
	    	  url:"books/initBooks",
	    	  method:"post",
	    	  data:{
	    		  "category":category, 
	    		  "page": page,
	    		  "limit": limit,
	    		  "discount":discount,
	    		  "newset":newset,
	    		  "saleNum":saleNum,
	    		  "price":price,
	    		  "lowsetPrice":lowsetPrice,
	    		  "highestPrice":highestPrice
	    	  },
	    	  success:function(data){
	    		  console.log(data.pageInfo)
	    		  totalPage = data.pageInfo.pages
	    		  limit = data.pageInfo.pageSize
	    		  currpage = data.pageInfo.pageNum
	    		  $(".papigationPage").html("第"+currpage+"页/共"+totalPage+"页")
	    		  let owlhtml='';
	    		  $.each(data.books,function(index,ndata){
						owlhtml += "<div class=\"new_prod_box col-md-4 col-sm-6\" style=\"border:1px\">"
						owlhtml += "<div class=\"new_prod_bg\">"
						owlhtml += " <a href=\"detail.html?bId="+ndata['bId']+"\"><img src=\"img/book_images/"+ndata['bId']+".jpg\" class=\"thumb\"></a>"
						owlhtml += "<span class=\"price\">￥"+(ndata['bDiscount']/100 *ndata['bPrice']).toFixed(2)+"</span></br>"
						owlhtml += "<span class=\"discount\">原价:"+ndata['bPrice'] +"</span>"
						owlhtml += " <a class=\"overflow_text\" href=\"detail.html?bId="+ndata['bId']+"\">"+ndata['bName']+"</a>"
						owlhtml += "</div></div>"
						$(".new_products").html(owlhtml);
					})
	    	  },
	    	  error:function(){}
	      })
	}
	
	function toPage(str) {
			console.log(str)
			if(str == "index"){
				getLists(1,limit)
			}
			if(str == "end") {
				getLists(totalPage,limit)
			}
			if(str == "prev"){
				if(currpage>1) {
					getLists(currpage-1,limit)
				}else {
					alert("已经是第一页")
					getLists(1,limit)
				}
				
			}
			if(str == "next") {
				if(currpage < totalPage) {
					getLists(currpage+1,limit)
				}else {
					alert("已经是最后一页")
					getLists(totalPage,limit)
				}
			}
		}
	
	//是否为正整数  
  	function isPositiveNum(s){
    var re = /^[0-9]*[1-9][0-9]*$/ ;  
    return re.test(s)  
	} 
	//是否正数
  	function validate(num)
  	{
  	  var reg = /^\d+(?=\.{0,1}\d+$|$)/
  	  if(reg.test(num)){return true};
  	  return false ;  
  	}

  	$("#pageSize").blur(function(){
  		var size = $("#pageSize").val()
  		if(isPositiveNum(size)) {
  			limit = Number(size)
  	  		getLists(1,limit)
  		}else {
  			alert("请输入大于0的整数值")
  		}
  	})
  	
  	$("#defaut").click(function(){
  		clearInfo()
  		getLists(1,limit)
  	})
  	
  	$("#b_sale_num_asc").click(function(){
  		clearInfo()
  		saleNum = 'asc'
  		getLists(1,limit)
  	})
  	
  	$("#b_sale_num_desc").click(function(){
  		clearInfo()
  		saleNum = 'desc'
  		getLists(1,limit)
  	})
  	
  	$("#b_discount_asc").click(function(){
  		clearInfo()
		discount = 'asc'
	  	getLists(1,limit)
  	})
  	
  	$("#b_discount_desc").click(function(){
  		clearInfo()
		discount = 'desc'
	  	getLists(1,limit)
  	})
  	
  	
	$("#b_add_time_asc").click(function(){
		clearInfo()
		newset = 'asc'
	  	getLists(1,limit)
  	})
  	
  	$("#b_add_time_asc").click(function(){
  		clearInfo()
		newset = 'desc'
	  	getLists(1,limit)
  	})	
  	
  	$("#b_price_asc").click(function(){
  		clearInfo()
  		price = 'asc'
	  	getLists(1,limit)
  	})
  	
  	$("#b_price_asc").click(function(){
  		clearInfo()
  		price = 'desc'
	  	getLists(1,limit)
  	})	
  	
  	$("#input_submit").click(function(){
  		clearInfo()
  		lowsetPrice  = $("#input_left").val()
  		highestPrice = $("#input_right").val()
  		console.log(validate(lowsetPrice),validate(highestPrice))
  		if(validate(lowsetPrice) && validate(highestPrice)) {
  			getLists(1,limit)
  		}else{
  			if(!validate(lowsetPrice) || !validate(highestPrice)) {
  				alert("请输入大于等于0 的正数")
  			}else {
  				alert("请输入价格区间")
  			}
  			
  		}
  	})

  	$("#input_reset").click(function(){
  		$("#input_left").val("")
  		$("#input_right").val("")
  	})
  	
  	function clearInfo() {
  		 discount = '';
  		 saleNum = '';
  		 newset = '';
  		 price = '';
  		 lowsetPrice = '';
  		 highestPrice = ''
  	}
  	
</script>
</html>
